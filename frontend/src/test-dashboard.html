<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Automation Service Hub - Test Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen">
        <header class="bg-blue-600 text-white p-4">
            <h1 class="text-2xl font-bold">🧪 QA Automation Service Hub - Test Dashboard</h1>
            <p class="text-blue-200">Test your backend APIs and view results</p>
        </header>

        <main class="container mx-auto p-6">
            <!-- API Status -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">🔌 API Connection Status</h2>
                <div id="api-status" class="text-lg font-bold text-gray-500">Checking...</div>
            </div>

            <!-- MCP (Model Context Protocol) Integration - FEATURED -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-xl p-6 mb-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="bg-white bg-opacity-20 rounded-full p-3 mr-4">
                            <span class="text-2xl">🔗</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold">MCP (Model Context Protocol) Integration</h2>
                            <p class="text-indigo-100">Industry-standard protocol for seamless AI tool integration</p>
                        </div>
                    </div>
                    <span class="px-3 py-1 bg-yellow-400 bg-opacity-90 text-yellow-900 rounded-full text-sm font-bold">FEATURED</span>
                </div>
                
                <!-- User Guide Toggle -->
                <div class="mb-6">
                    <button onclick="toggleMCPGuide()" 
                            class="px-4 py-2 bg-yellow-400 bg-opacity-90 text-yellow-900 rounded-lg hover:bg-opacity-100 font-medium backdrop-blur-sm flex items-center">
                        <span class="mr-2">📖</span>
                        <span id="guideToggleText">Show Complete User Guide</span>
                    </button>
                </div>
                
                <!-- Comprehensive User Guide -->
                <div id="mcpGuide" class="hidden mb-6 bg-white bg-opacity-15 rounded-lg p-5 backdrop-blur-sm border border-white border-opacity-20">
                    <h3 class="text-2xl font-bold mb-4 text-yellow-200 flex items-center">
                        <span class="mr-2">🎯</span>
                        Complete MCP User Guide
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Quick Start -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-green-200 border-b border-green-300 pb-2">🚀 Quick Start</h4>
                            <div class="space-y-3 text-sm">
                                <div class="bg-green-500 bg-opacity-20 p-3 rounded border-l-4 border-green-300">
                                    <strong class="text-green-200">Step 1:</strong> Click "🎯 Run MCP Demo" to see everything in action
                                </div>
                                <div class="bg-blue-500 bg-opacity-20 p-3 rounded border-l-4 border-blue-300">
                                    <strong class="text-blue-200">Step 2:</strong> Explore the results to understand MCP capabilities
                                </div>
                                <div class="bg-purple-500 bg-opacity-20 p-3 rounded border-l-4 border-purple-300">
                                    <strong class="text-purple-200">Step 3:</strong> Try individual tools for specific tasks
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Features -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-blue-200 border-b border-blue-300 pb-2">🔧 Detailed Features</h4>
                            <div class="space-y-3 text-sm">
                                <div class="bg-indigo-500 bg-opacity-20 p-3 rounded">
                                    <strong class="text-indigo-200">🛠️ MCP Tools:</strong> AI-powered automation for test data generation, analysis, validation, performance testing, and report generation.
                                </div>
                                <div class="bg-teal-500 bg-opacity-20 p-3 rounded">
                                    <strong class="text-teal-200">📂 MCP Resources:</strong> Access to QA guides, best practices, testing templates, and documentation.
                                </div>
                                <div class="bg-pink-500 bg-opacity-20 p-3 rounded">
                                    <strong class="text-pink-200">💭 MCP Prompts:</strong> Pre-built conversation starters for test analysis, documentation, optimization, and bug reporting.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Workflow Guide -->
                    <div class="mt-6 bg-gradient-to-r from-purple-500 to-pink-500 bg-opacity-20 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-yellow-200 mb-3">📋 Recommended Workflow</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs">
                            <div class="text-center">
                                <div class="text-2xl mb-2">1️⃣</div>
                                <strong class="text-green-200">Explore Tools</strong>
                                <p class="text-indigo-100 mt-1">Start with "📋 List Tools" to see what's available</p>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl mb-2">2️⃣</div>
                                <strong class="text-blue-200">Generate Data</strong>
                                <p class="text-indigo-100 mt-1">Use tools to create test data and analyze results</p>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl mb-2">3️⃣</div>
                                <strong class="text-purple-200">Access Resources</strong>
                                <p class="text-indigo-100 mt-1">Read documentation and use prompts for AI tools</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- What Each Action Does -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-orange-200 mb-3">🎬 What Each Action Does</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                            <div class="space-y-2">
                                <div class="bg-gray-700 bg-opacity-50 p-2 rounded">
                                    <strong class="text-yellow-300">📋 List Tools:</strong> <span class="text-gray-200">Shows all available MCP tools with descriptions</span>
                                </div>
                                <div class="bg-gray-700 bg-opacity-50 p-2 rounded">
                                    <strong class="text-yellow-300">🚀 Call Tool:</strong> <span class="text-gray-200">Executes selected tool with intelligent parameters</span>
                                </div>
                                <div class="bg-gray-700 bg-opacity-50 p-2 rounded">
                                    <strong class="text-yellow-300">📋 List Resources:</strong> <span class="text-gray-200">Displays QA documentation and guides</span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="bg-gray-700 bg-opacity-50 p-2 rounded">
                                    <strong class="text-yellow-300">📖 Read Resource:</strong> <span class="text-gray-200">Opens detailed content of selected resource</span>
                                </div>
                                <div class="bg-gray-700 bg-opacity-50 p-2 rounded">
                                    <strong class="text-yellow-300">📋 List Prompts:</strong> <span class="text-gray-200">Shows AI conversation templates</span>
                                </div>
                                <div class="bg-gray-700 bg-opacity-50 p-2 rounded">
                                    <strong class="text-yellow-300">✨ Generate Prompt:</strong> <span class="text-gray-200">Creates customized AI prompts for your needs</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <!-- MCP Tools -->
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 backdrop-blur-sm">
                        <h3 class="font-semibold mb-2 text-white">🛠️ MCP Tools</h3>
                        <p class="text-sm text-indigo-100 mb-3">Available tools for AI integration</p>
                        <div class="space-y-2">
                            <button onclick="listMCPTools()" 
                                    class="w-full px-3 py-2 bg-white bg-opacity-20 text-white rounded-md hover:bg-opacity-30 text-sm backdrop-blur-sm transition-all duration-200">
                                📋 List Tools
                            </button>
                            <select id="mcpToolSelect" class="w-full px-3 py-2 bg-white bg-opacity-20 text-white rounded-md text-sm hidden backdrop-blur-sm">
                                <option value="">Select a tool...</option>
                            </select>
                            <button onclick="callMCPTool()" 
                                    class="w-full px-3 py-2 bg-white bg-opacity-30 text-white rounded-md hover:bg-opacity-40 text-sm hidden backdrop-blur-sm transition-all duration-200" id="callToolBtn">
                                🚀 Call Tool
                            </button>
                        </div>
                    </div>

                    <!-- MCP Resources -->
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 backdrop-blur-sm">
                        <h3 class="font-semibold mb-2 text-white">📂 MCP Resources</h3>
                        <p class="text-sm text-indigo-100 mb-3">Access test data and reports</p>
                        <div class="space-y-2">
                            <button onclick="listMCPResources()" 
                                    class="w-full px-3 py-2 bg-white bg-opacity-20 text-white rounded-md hover:bg-opacity-30 text-sm backdrop-blur-sm transition-all duration-200">
                                📋 List Resources
                            </button>
                            <select id="mcpResourceSelect" class="w-full px-3 py-2 bg-white bg-opacity-20 text-white rounded-md text-sm hidden backdrop-blur-sm">
                                <option value="">Select a resource...</option>
                            </select>
                            <button onclick="readMCPResource()" 
                                    class="w-full px-3 py-2 bg-white bg-opacity-30 text-white rounded-md hover:bg-opacity-40 text-sm hidden backdrop-blur-sm transition-all duration-200" id="readResourceBtn">
                                📖 Read Resource
                            </button>
                        </div>
                    </div>

                    <!-- MCP Prompts -->
                    <div class="bg-white bg-opacity-10 rounded-lg p-4 backdrop-blur-sm">
                        <h3 class="font-semibold mb-2 text-white">💬 MCP Prompts</h3>
                        <p class="text-sm text-indigo-100 mb-3">Generate AI prompts for testing</p>
                        <div class="space-y-2">
                            <button onclick="listMCPPrompts()" 
                                    class="w-full px-3 py-2 bg-white bg-opacity-20 text-white rounded-md hover:bg-opacity-30 text-sm backdrop-blur-sm transition-all duration-200">
                                📋 List Prompts
                            </button>
                            <select id="mcpPromptSelect" class="w-full px-3 py-2 bg-white bg-opacity-20 text-white rounded-md text-sm hidden backdrop-blur-sm">
                                <option value="">Select a prompt...</option>
                            </select>
                            <button onclick="getMCPPrompt()" 
                                    class="w-full px-3 py-2 bg-white bg-opacity-30 text-white rounded-md hover:bg-opacity-40 text-sm hidden backdrop-blur-sm transition-all duration-200" id="getPromptBtn">
                                ✨ Generate Prompt
                            </button>
                        </div>
                    </div>
                </div>

                <!-- MCP Demo -->
                <div class="mb-4 text-center">
                    <button onclick="runMCPDemo()" 
                            class="px-8 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg hover:from-green-600 hover:to-blue-600 font-bold text-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                        🎯 Run MCP Demo
                    </button>
                    <p class="mt-2 text-indigo-100 text-sm">Demonstrate MCP capabilities with real examples - see everything in action!</p>
                </div>

                <!-- MCP Results -->
                <div id="mcpResults" class="mt-4 hidden">
                    <h3 class="text-lg font-medium mb-2 text-white flex items-center">
                        <span class="mr-2">🔗</span>
                        MCP Results:
                    </h3>
                    <div id="mcp-output" class="bg-gray-900 bg-opacity-90 rounded-lg p-4 max-h-96 overflow-y-auto backdrop-blur-sm text-gray-100 border border-gray-600">
                    </div>
                </div>
            </div>

            <!-- Enhanced Test Data Generation -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">🚀 Enhanced Test Data Generation</h2>
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium">Powered by MCP</span>
                </div>
                <p class="text-gray-600 mb-4">Generate realistic test data using MCP tools with relationships and advanced features</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <!-- Enhanced Users -->
                    <div class="border rounded-lg p-4 bg-gradient-to-br from-green-50 to-blue-50">
                        <h3 class="font-semibold mb-2 text-green-800">👥 Enhanced Users</h3>
                        <p class="text-sm text-gray-600 mb-3">Complete user profiles via MCP generate_test_data tool</p>
                        <div class="space-y-2">
                            <input type="number" id="userCount" placeholder="User Count" min="1" max="20" value="3"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                            <select id="userFormat" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="json">JSON Format</option>
                                <option value="csv">CSV Format</option>
                                <option value="xml">XML Format</option>
                            </select>
                            <button onclick="generateEnhancedUsersMCP()" 
                                    class="w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-medium">
                                🔗 Generate via MCP
                            </button>
                        </div>
                    </div>

                    <!-- Enhanced Orders -->
                    <div class="border rounded-lg p-4 bg-gradient-to-br from-purple-50 to-pink-50">
                        <h3 class="font-semibold mb-2 text-purple-800">🛒 Enhanced Orders</h3>
                        <p class="text-sm text-gray-600 mb-3">Realistic orders via MCP generate_test_data tool</p>
                        <div class="space-y-2">
                            <input type="number" id="orderCount" placeholder="Order Count" min="1" max="20" value="5"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                            <select id="orderFormat" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="json">JSON Format</option>
                                <option value="csv">CSV Format</option>
                                <option value="xml">XML Format</option>
                            </select>
                            <button onclick="generateEnhancedOrdersMCP()" 
                                    class="w-full px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 text-sm font-medium">
                                🔗 Generate via MCP
                            </button>
                        </div>
                    </div>

                    <!-- Mixed Data -->
                    <div class="border rounded-lg p-4 bg-gradient-to-br from-orange-50 to-red-50">
                        <h3 class="font-semibold mb-2 text-orange-800">📦 Mixed Data</h3>
                        <p class="text-sm text-gray-600 mb-3">Combined users, orders & products via MCP</p>
                        <div class="space-y-2">
                            <input type="number" id="mixedCount" placeholder="Item Count" min="1" max="15" value="10"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                            <select id="mixedFormat" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="json">JSON Format</option>
                                <option value="csv">CSV Format</option>
                                <option value="xml">XML Format</option>
                            </select>
                            <button onclick="generateMixedDataMCP()" 
                                    class="w-full px-3 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 text-sm font-medium">
                                🔗 Generate via MCP
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Results -->
                <div id="enhancedResults" class="mt-4 hidden">
                    <h3 class="text-lg font-medium mb-2 flex items-center">
                        <span class="mr-2">🔗</span>
                        MCP Generated Data:
                    </h3>
                    <div id="enhanced-data-output" class="bg-gray-900 border rounded-md p-4 max-h-96 overflow-y-auto text-green-300 font-mono text-sm">
                    </div>
                </div>
            </div>

            <!-- 🤖 FREE AI Analysis -->
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">🤖 FREE AI-Powered Analysis</h2>
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">Powered by MCP</span>
                </div>
                <p class="text-gray-600 mb-4">Get intelligent insights using MCP analyze_with_ai tool - completely FREE!</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- AI Demo -->
                    <div class="border rounded-lg p-4 bg-gradient-to-br from-blue-50 to-indigo-50">
                        <h3 class="font-semibold mb-2 text-blue-800">🎯 AI Demo via MCP</h3>
                        <p class="text-sm text-gray-600 mb-3">Try AI analysis with sample data using MCP tools</p>
                        <div class="space-y-2">
                            <select id="aiDemoType" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="summary">Summary Analysis</option>
                                <option value="recommendations">Recommendations</option>
                                <option value="documentation">Documentation</option>
                                <option value="patterns">Pattern Analysis</option>
                            </select>
                            <select id="aiProvider" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="mock">Mock AI (FREE)</option>
                                <option value="huggingface">HuggingFace (FREE)</option>
                                <option value="ollama">Ollama (Local)</option>
                            </select>
                            <button onclick="runAIDemoMCP()" 
                                    class="w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium">
                                � Analyze via MCP
                            </button>
                        </div>
                    </div>

                    <!-- Analyze Generated Data -->
                    <div class="border rounded-lg p-4 bg-gradient-to-br from-green-50 to-teal-50">
                        <h3 class="font-semibold mb-2 text-green-800">🔍 Analyze Generated Data</h3>
                        <p class="text-sm text-gray-600 mb-3">AI analysis of your test data using MCP tools</p>
                        <div class="space-y-2">
                            <select id="aiAnalysisType" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="summary">Data Summary</option>
                                <option value="recommendations">Get Recommendations</option>
                                <option value="documentation">Generate Docs</option>
                                <option value="patterns">Find Patterns</option>
                            </select>
                            <select id="analysisProvider" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="mock">Mock AI (FREE)</option>
                                <option value="huggingface">HuggingFace (FREE)</option>
                                <option value="ollama">Ollama (Local)</option>
                            </select>
                            <button onclick="analyzeCurrentDataMCP()" 
                                    class="w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-medium">
                                🔗 Analyze via MCP
                            </button>
                            <p class="text-xs text-gray-500 mt-2">
                                Powered by MCP analyze_with_ai tool • <button onclick="showMCPCapabilities()" class="text-blue-600 hover:underline">View MCP Tools</button>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- AI Results -->
                <div id="aiResults" class="mt-4 hidden">
                    <h3 class="text-lg font-medium mb-2 text-blue-700 flex items-center">
                        <span class="mr-2">🔗</span>
                        MCP AI Analysis Results:
                    </h3>
                    <div id="ai-output" class="bg-gray-900 border rounded-md p-4 max-h-96 overflow-y-auto text-cyan-300 font-mono text-sm">
                    </div>
                </div>
            </div>

            <!-- Quick API Tests -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">⚡ Quick API Tests</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <button onclick="testHealthCheck()" 
                            class="p-4 border-2 border-green-300 rounded-lg hover:bg-green-50">
                        <div class="text-2xl mb-2">❤️</div>
                        <div class="font-medium">Health Check</div>
                    </button>
                    
                    <button onclick="testTemplates()" 
                            class="p-4 border-2 border-blue-300 rounded-lg hover:bg-blue-50">
                        <div class="text-2xl mb-2">📋</div>
                        <div class="font-medium">Get Templates</div>
                    </button>
                    
                    <button onclick="testSwagger()" 
                            class="p-4 border-2 border-purple-300 rounded-lg hover:bg-purple-50">
                        <div class="text-2xl mb-2">📚</div>
                        <div class="font-medium">Open Swagger</div>
                    </button>
                    
                    <button onclick="testMetrics()" 
                            class="p-4 border-2 border-orange-300 rounded-lg hover:bg-orange-50">
                        <div class="text-2xl mb-2">📊</div>
                        <div class="font-medium">View Metrics</div>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';

        // Check API status on load
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
        });

        async function checkApiStatus() {
            const statusElement = document.getElementById('api-status');
            try {
                console.log('Checking API status at:', `${API_BASE}/actuator/health`);
                const response = await fetch(`${API_BASE}/actuator/health`);
                console.log('API response status:', response.status);
                if (response.ok) {
                    const data = await response.json();
                    console.log('API health data:', data);
                    statusElement.textContent = '✅ Connected';
                    statusElement.className = 'text-lg font-bold text-green-600';
                } else {
                    throw new Error(`API not healthy - Status: ${response.status}`);
                }
            } catch (error) {
                console.error('API connection error:', error);
                statusElement.textContent = `❌ Disconnected (${error.message})`;
                statusElement.className = 'text-lg font-bold text-red-600';
            }
        }

        async function testHealthCheck() {
            try {
                const response = await fetch(`${API_BASE}/actuator/health`);
                const data = await response.json();
                alert('Health Check Result:\\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                alert('Health check failed: ' + error.message);
            }
        }

        async function testTemplates() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/testdata/templates`);
                const data = await response.json();
                alert('Available Templates:\\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                alert('Failed to get templates: ' + error.message);
            }
        }

        function testSwagger() {
            window.open(`${API_BASE}/swagger-ui.html`, '_blank');
        }

        function testMetrics() {
            window.open(`${API_BASE}/actuator/metrics`, '_blank');
        }

        // Enhanced Test Data Generation Functions
        async function generateEnhancedUsers() {
            const count = document.getElementById('userCount').value;
            const includeOrders = document.getElementById('includeUserOrders').checked;
            
            try {
                console.log('Generating enhanced users:', count, 'includeOrders:', includeOrders);
                const response = await fetch(`${API_BASE}/api/v2/testdata/users?count=${count}&includeOrders=${includeOrders}`);
                console.log('Enhanced users response status:', response.status);
                const data = await response.json();
                console.log('Enhanced users data:', data);
                
                displayEnhancedResults(data, `Enhanced Users (${data.length} generated)`);
                updateLastGeneratedData(data);
            } catch (error) {
                console.error('Error generating enhanced users:', error);
                alert('Error generating enhanced users: ' + error.message);
            }
        }

        async function generateUsersWithOrders() {
            const userCount = document.getElementById('userOrderCount').value;
            const minOrders = document.getElementById('minOrders').value;
            const maxOrders = document.getElementById('maxOrders').value;
            
            try {
                console.log('Generating users with orders:', userCount, 'orders:', minOrders, '-', maxOrders);
                const response = await fetch(`${API_BASE}/api/v2/testdata/users-with-orders?userCount=${userCount}&minOrders=${minOrders}&maxOrders=${maxOrders}`);
                console.log('Users with orders response status:', response.status);
                const data = await response.json();
                console.log('Users with orders data:', data);
                
                displayEnhancedResults(data, `Users with Orders (${data.length} users, ${data.reduce((sum, user) => sum + (user.orders ? user.orders.length : 0), 0)} total orders)`);
                updateLastGeneratedData(data);
            } catch (error) {
                console.error('Error generating users with orders:', error);
                alert('Error generating users with orders: ' + error.message);
            }
        }

        async function generateEnhancedOrders() {
            const count = document.getElementById('orderCount').value;
            const includeItems = document.getElementById('includeOrderItems').checked;
            
            try {
                console.log('Generating enhanced orders:', count, 'includeItems:', includeItems);
                const response = await fetch(`${API_BASE}/api/v2/testdata/orders?count=${count}&includeItems=${includeItems}`);
                console.log('Enhanced orders response status:', response.status);
                const data = await response.json();
                console.log('Enhanced orders data:', data);
                
                displayEnhancedResults(data, `Enhanced Orders (${data.length} generated)`);
                updateLastGeneratedData(data);
            } catch (error) {
                console.error('Error generating enhanced orders:', error);
                alert('Error generating enhanced orders: ' + error.message);
            }
        }

        function displayEnhancedResults(data, title) {
            document.getElementById('enhancedResults').classList.remove('hidden');
            document.getElementById('enhanced-data-output').innerHTML = 
                `<h4 class="font-semibold text-green-700 mb-2">${title}</h4>` +
                '<pre class="text-sm">' + JSON.stringify(data, null, 2) + '</pre>';
        }

        // 🤖 FREE AI Analysis Functions
        let lastGeneratedData = null;

        async function runAIDemo() {
            const analysisType = document.getElementById('aiDemoType').value;
            
            try {
                console.log('Running AI demo with type:', analysisType);
                const response = await fetch(`${API_BASE}/api/v1/ai/demo?analysisType=${analysisType}`);
                console.log('AI demo response status:', response.status);
                const data = await response.json();
                console.log('AI demo data:', data);
                
                displayAIResults(data, `🤖 AI Demo Analysis - ${analysisType.toUpperCase()}`);
            } catch (error) {
                console.error('Error running AI demo:', error);
                alert('Error running AI demo: ' + error.message);
            }
        }

        async function analyzeCurrentData() {
            const analysisType = document.getElementById('aiAnalysisType').value;
            
            if (!lastGeneratedData) {
                alert('Please generate some test data first, then try AI analysis');
                return;
            }
            
            try {
                console.log('Analyzing current data with type:', analysisType);
                const requestBody = {
                    analysisType: analysisType,
                    testData: lastGeneratedData,
                    options: {
                        includeDetails: true,
                        includeRecommendations: true,
                        focusAreas: ['data_quality', 'test_coverage', 'optimization']
                    }
                };
                
                const response = await fetch(`${API_BASE}/api/v1/ai/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('AI analysis response status:', response.status);
                const data = await response.json();
                console.log('AI analysis data:', data);
                
                displayAIResults(data, `🔍 AI Analysis of Your Data - ${analysisType.toUpperCase()}`);
            } catch (error) {
                console.error('Error analyzing data:', error);
                alert('Error analyzing data: ' + error.message);
            }
        }

        async function showAICapabilities() {
            try {
                console.log('Fetching AI capabilities');
                const response = await fetch(`${API_BASE}/api/v1/ai/capabilities`);
                console.log('AI capabilities response status:', response.status);
                const data = await response.json();
                console.log('AI capabilities data:', data);
                
                displayAICapabilities(data);
            } catch (error) {
                console.error('Error fetching AI capabilities:', error);
                alert('Error fetching AI capabilities: ' + error.message);
            }
        }

        function displayAIResults(data, title) {
            document.getElementById('aiResults').classList.remove('hidden');
            
            let html = `<h4 class="font-semibold text-blue-700 mb-3">${title}</h4>`;
            
            // Summary
            if (data.summary) {
                html += `<div class="mb-4">
                    <h5 class="font-medium text-gray-800 mb-2">📝 Summary</h5>
                    <p class="text-gray-700 bg-white p-3 rounded border">${data.summary}</p>
                </div>`;
            }
            
            // Insights
            if (data.insights && data.insights.length > 0) {
                html += `<div class="mb-4">
                    <h5 class="font-medium text-gray-800 mb-2">💡 Key Insights</h5>
                    <div class="space-y-2">`;
                
                data.insights.forEach(insight => {
                    const importanceStars = '⭐'.repeat(insight.importance || 3);
                    html += `<div class="bg-white p-3 rounded border">
                        <div class="flex justify-between items-start">
                            <span class="font-medium text-gray-800">${insight.category}</span>
                            <span class="text-sm">${importanceStars}</span>
                        </div>
                        <p class="text-gray-600 text-sm mt-1">${insight.description}</p>
                    </div>`;
                });
                
                html += `</div></div>`;
            }
            
            // Recommendations
            if (data.recommendations && data.recommendations.length > 0) {
                html += `<div class="mb-4">
                    <h5 class="font-medium text-gray-800 mb-2">🎯 Recommendations</h5>
                    <div class="space-y-2">`;
                
                data.recommendations.forEach(rec => {
                    const priorityColor = {
                        'high': 'text-red-600 bg-red-50',
                        'medium': 'text-yellow-600 bg-yellow-50',
                        'low': 'text-green-600 bg-green-50'
                    }[rec.priority] || 'text-gray-600 bg-gray-50';
                    
                    html += `<div class="bg-white p-3 rounded border">
                        <div class="flex justify-between items-start">
                            <span class="font-medium text-gray-800">${rec.type}</span>
                            <span class="px-2 py-1 rounded text-xs ${priorityColor}">${rec.priority}</span>
                        </div>
                        <p class="text-gray-600 text-sm mt-1">${rec.description}</p>
                        <div class="flex gap-4 mt-2 text-xs text-gray-500">
                            <span>Effort: ${rec.effort}</span>
                            <span>Impact: ${rec.impact}</span>
                        </div>
                    </div>`;
                });
                
                html += `</div></div>`;
            }
            
            // Metrics
            if (data.metrics) {
                html += `<div class="mb-4">
                    <h5 class="font-medium text-gray-800 mb-2">📊 Analysis Metrics</h5>
                    <div class="bg-white p-3 rounded border">
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>Model: <span class="font-medium">${data.modelUsed}</span></div>
                            <div>Confidence: <span class="font-medium">${Math.round((data.confidenceScore || 0) * 100)}%</span></div>
                            <div>Processing: <span class="font-medium">${data.processingTimeMs}ms</span></div>
                            <div>Provider: <span class="font-medium">${data.metrics.ai_provider || 'unknown'}</span></div>
                        </div>
                    </div>
                </div>`;
            }
            
            document.getElementById('ai-output').innerHTML = html;
        }

        function displayAICapabilities(data) {
            document.getElementById('aiResults').classList.remove('hidden');
            
            let html = `<h4 class="font-semibold text-purple-700 mb-3">⚙️ AI Configuration & Capabilities</h4>`;
            
            // Current setup
            html += `<div class="mb-4 bg-white p-4 rounded border">
                <h5 class="font-medium text-gray-800 mb-2">Current Setup</h5>
                <div class="text-sm">
                    <p><span class="font-medium">Provider:</span> ${data.current_provider}</p>
                    <p><span class="font-medium">Cost:</span> <span class="text-green-600 font-bold">${data.cost}</span></p>
                </div>
            </div>`;
            
            // Available providers
            html += `<div class="mb-4">
                <h5 class="font-medium text-gray-800 mb-2">🆓 Free AI Options</h5>
                <div class="space-y-3">`;
            
            Object.entries(data.available_providers).forEach(([key, provider]) => {
                const isActive = key === data.current_provider;
                const borderColor = isActive ? 'border-green-500 bg-green-50' : 'border-gray-200 bg-white';
                
                html += `<div class="p-3 rounded border ${borderColor}">
                    <div class="flex justify-between items-start mb-2">
                        <h6 class="font-medium">${key.toUpperCase()}</h6>
                        <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">${provider.cost}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${provider.description}</p>
                    ${provider.setup ? `<p class="text-xs text-blue-600">${provider.setup}</p>` : ''}
                    ${isActive ? '<p class="text-xs text-green-600 font-medium mt-1">✅ Currently Active</p>' : ''}
                </div>`;
            });
            
            html += `</div></div>`;
            
            // Analysis types
            html += `<div class="mb-4 bg-white p-4 rounded border">
                <h5 class="font-medium text-gray-800 mb-2">Available Analysis Types</h5>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">`;
            
            Object.entries(data.analysis_types).forEach(([type, description]) => {
                html += `<div class="p-2 bg-gray-50 rounded">
                    <span class="font-medium">${type}:</span> ${description}
                </div>`;
            });
            
            html += `</div></div>`;
            
            document.getElementById('ai-output').innerHTML = html;
        }

        // Update the existing functions to store data for AI analysis
        function updateLastGeneratedData(data) {
            lastGeneratedData = data;
        }

        // ====================================
        // MCP (Model Context Protocol) Functions
        // ====================================

        // List available MCP tools
        async function listMCPTools() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/tools`);
                const data = await response.json();
                
                if (data.tools && data.tools.length > 0) {
                    const select = document.getElementById('mcpToolSelect');
                    const callBtn = document.getElementById('callToolBtn');
                    
                    select.innerHTML = '<option value="">Select a tool...</option>';
                    data.tools.forEach(tool => {
                        const option = document.createElement('option');
                        option.value = tool.name;
                        option.textContent = `${tool.name} - ${tool.description}`;
                        select.appendChild(option);
                    });
                    
                    select.classList.remove('hidden');
                    callBtn.classList.remove('hidden');
                    
                    displayMCPResults('tools_list', {
                        message: `Found ${data.tools.length} MCP tools`,
                        tools: data.tools
                    });
                } else {
                    displayMCPResults('error', { message: 'No MCP tools available' });
                }
            } catch (error) {
                console.error('Error listing MCP tools:', error);
                displayMCPResults('error', { message: `Error: ${error.message}` });
            }
        }

        // Call selected MCP tool
        async function callMCPTool() {
            const toolName = document.getElementById('mcpToolSelect').value;
            if (!toolName) {
                alert('Please select a tool first');
                return;
            }

            try {
                // Prepare arguments based on tool type
                let arguments = {};
                switch (toolName) {
                    case 'generate_test_data':
                        arguments = {
                            type: 'users',
                            count: 5,
                            format: 'json'
                        };
                        break;
                    case 'analyze_with_ai':
                        arguments = {
                            data: lastGeneratedData || { sample: 'data' },
                            analysis_type: 'summary',
                            ai_provider: 'mock'
                        };
                        break;
                    case 'validate_test_data':
                        arguments = {
                            test_data: lastGeneratedData || { sample: 'data' },
                            validation_rules: ['not_null', 'valid_format'],
                            strict_mode: false
                        };
                        break;
                    case 'run_performance_test':
                        arguments = {
                            endpoint: `${API_BASE}/api/v1/enhanced-test-data/users`,
                            concurrent_users: 10,
                            duration: '30s'
                        };
                        break;
                    case 'generate_test_report':
                        arguments = {
                            test_results: {
                                total: 100,
                                passed: 95,
                                failed: 5,
                                execution_time: '2m 15s'
                            },
                            report_format: 'json',
                            include_metrics: true
                        };
                        break;
                }

                const response = await fetch(`${API_BASE}/api/v1/mcp/tools/${toolName}/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(arguments)
                });

                const data = await response.json();
                displayMCPResults('tool_call', {
                    tool: toolName,
                    arguments: arguments,
                    result: data
                });

            } catch (error) {
                console.error('Error calling MCP tool:', error);
                displayMCPResults('error', { message: `Error calling tool: ${error.message}` });
            }
        }

        // List available MCP resources
        async function listMCPResources() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/resources`);
                const data = await response.json();
                
                if (data.resources && data.resources.length > 0) {
                    const select = document.getElementById('mcpResourceSelect');
                    const readBtn = document.getElementById('readResourceBtn');
                    
                    select.innerHTML = '<option value="">Select a resource...</option>';
                    data.resources.forEach(resource => {
                        const option = document.createElement('option');
                        option.value = resource.uri;
                        option.textContent = `${resource.name} - ${resource.description}`;
                        select.appendChild(option);
                    });
                    
                    select.classList.remove('hidden');
                    readBtn.classList.remove('hidden');
                    
                    displayMCPResults('resources_list', {
                        message: `Found ${data.resources.length} MCP resources`,
                        resources: data.resources
                    });
                } else {
                    displayMCPResults('error', { message: 'No MCP resources available' });
                }
            } catch (error) {
                console.error('Error listing MCP resources:', error);
                displayMCPResults('error', { message: `Error: ${error.message}` });
            }
        }

        // Read selected MCP resource
        async function readMCPResource() {
            const resourceUri = document.getElementById('mcpResourceSelect').value;
            if (!resourceUri) {
                alert('Please select a resource first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/resources/read?uri=${encodeURIComponent(resourceUri)}`);
                const data = await response.json();
                
                displayMCPResults('resource_content', {
                    uri: resourceUri,
                    content: data
                });
            } catch (error) {
                console.error('Error reading MCP resource:', error);
                displayMCPResults('error', { message: `Error reading resource: ${error.message}` });
            }
        }

        // List available MCP prompts
        async function listMCPPrompts() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/prompts`);
                const data = await response.json();
                
                if (data.prompts && data.prompts.length > 0) {
                    const select = document.getElementById('mcpPromptSelect');
                    const getBtn = document.getElementById('getPromptBtn');
                    
                    select.innerHTML = '<option value="">Select a prompt...</option>';
                    data.prompts.forEach(prompt => {
                        const option = document.createElement('option');
                        option.value = prompt.name;
                        option.textContent = `${prompt.name} - ${prompt.description}`;
                        select.appendChild(option);
                    });
                    
                    select.classList.remove('hidden');
                    getBtn.classList.remove('hidden');
                    
                    displayMCPResults('prompts_list', {
                        message: `Found ${data.prompts.length} MCP prompts`,
                        prompts: data.prompts
                    });
                } else {
                    displayMCPResults('error', { message: 'No MCP prompts available' });
                }
            } catch (error) {
                console.error('Error listing MCP prompts:', error);
                displayMCPResults('error', { message: `Error: ${error.message}` });
            }
        }

        // Get selected MCP prompt
        async function getMCPPrompt() {
            const promptName = document.getElementById('mcpPromptSelect').value;
            if (!promptName) {
                alert('Please select a prompt first');
                return;
            }

            try {
                // Prepare arguments based on prompt type
                let arguments = {};
                switch (promptName) {
                    case 'analyze_test_results':
                        arguments = {
                            test_results: {
                                total_tests: 100,
                                passed: 95,
                                failed: 5,
                                execution_time: '2m 15s',
                                coverage: '92%'
                            },
                            focus_areas: ['performance', 'reliability']
                        };
                        break;
                    case 'document_test_case':
                        arguments = {
                            test_case: {
                                name: 'User Registration Test',
                                objective: 'Verify user can register with valid credentials',
                                steps: ['Navigate to registration', 'Enter valid data', 'Submit form'],
                                expected_result: 'User successfully registered'
                            },
                            style: 'technical'
                        };
                        break;
                    case 'optimize_test_suite':
                        arguments = {
                            test_suite: {
                                name: 'API Test Suite',
                                total_tests: 150,
                                execution_time: '15 minutes',
                                failure_rate: '3%',
                                maintenance_effort: 'high'
                            },
                            constraints: ['time', 'resources']
                        };
                        break;
                    case 'create_bug_report':
                        arguments = {
                            failure_details: {
                                test_name: 'Login Functionality Test',
                                error_message: 'Invalid credentials error for valid user',
                                steps_to_reproduce: ['Enter valid username', 'Enter valid password', 'Click login'],
                                expected_vs_actual: 'Expected: Login success, Actual: Error message'
                            },
                            environment: 'Staging environment, Chrome browser v91'
                        };
                        break;
                }

                const response = await fetch(`${API_BASE}/api/v1/mcp/prompts/${promptName}/get`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(arguments)
                });

                const data = await response.json();
                displayMCPResults('prompt_generated', {
                    prompt: promptName,
                    arguments: arguments,
                    content: data
                });

            } catch (error) {
                console.error('Error getting MCP prompt:', error);
                displayMCPResults('error', { message: `Error getting prompt: ${error.message}` });
            }
        }

        // Run MCP demo
        async function runMCPDemo() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/demo`);
                const data = await response.json();
                
                displayMCPResults('demo', data);
            } catch (error) {
                console.error('Error running MCP demo:', error);
                displayMCPResults('error', { message: `Demo error: ${error.message}` });
            }
        }

        // Toggle MCP guide visibility
        function toggleMCPGuide() {
            const guide = document.getElementById('mcpGuide');
            const toggleText = document.getElementById('guideToggleText');
            
            if (guide.classList.contains('hidden')) {
                guide.classList.remove('hidden');
                toggleText.textContent = 'Hide User Guide';
            } else {
                guide.classList.add('hidden');
                toggleText.textContent = 'Show Complete User Guide';
            }
        }

        // Display MCP results with better styling and contrast
        function displayMCPResults(type, data) {
            const resultsDiv = document.getElementById('mcpResults');
            const outputDiv = document.getElementById('mcp-output');
            
            resultsDiv.classList.remove('hidden');
            
            let html = '';
            
            switch (type) {
                case 'tools_list':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-green-400 font-bold text-lg">🛠️ MCP Tools Available (${data.tools.length})</span>
                            </div>
                            <div class="space-y-3">
                                ${data.tools.map(tool => `
                                    <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg hover:bg-gray-700 transition-colors">
                                        <div class="font-bold text-blue-300 text-lg">${tool.name}</div>
                                        <div class="text-gray-300 mt-1">${tool.description}</div>
                                        <div class="text-xs text-gray-400 mt-2">Click "🚀 Call Tool" after selecting this tool</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>`;
                    break;
                
                case 'tool_call':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-green-400 font-bold text-lg">🚀 Tool Call Result: ${data.tool}</span>
                            </div>
                            <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg">
                                <div class="mb-3">
                                    <div class="text-yellow-300 font-semibold mb-2">📝 Input Arguments:</div>
                                    <pre class="bg-gray-900 border border-gray-700 p-3 rounded text-green-300 text-sm overflow-x-auto">${JSON.stringify(data.arguments, null, 2)}</pre>
                                </div>
                                <div class="mb-3">
                                    <div class="text-blue-300 font-semibold mb-2">✅ Execution Result:</div>
                                    <pre class="bg-gray-900 border border-gray-700 p-3 rounded text-cyan-300 text-sm overflow-x-auto">${JSON.stringify(data.result, null, 2)}</pre>
                                </div>
                                <div class="text-xs text-gray-400 bg-gray-900 p-2 rounded border-l-4 border-blue-500">
                                    💡 This shows the tool was executed successfully. The result contains the generated data or analysis.
                                </div>
                            </div>
                        </div>`;
                    break;
                
                case 'resources_list':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-teal-400 font-bold text-lg">📂 MCP Resources Available (${data.resources.length})</span>
                            </div>
                            <div class="space-y-3">
                                ${data.resources.map(resource => `
                                    <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg hover:bg-gray-700 transition-colors">
                                        <div class="font-bold text-teal-300">${resource.name}</div>
                                        <div class="text-gray-300 mt-1">${resource.description}</div>
                                        <div class="text-xs text-gray-400 mt-2">URI: ${resource.uri}</div>
                                        <div class="text-xs text-purple-400 mt-1">Click "� Read Resource" after selecting this resource</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>`;
                    break;
                
                case 'resource_content':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-purple-400 font-bold text-lg">📖 Resource Content: ${data.uri}</span>
                            </div>
                            <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg">
                                <div class="text-gray-300 whitespace-pre-wrap">${data.content}</div>
                                <div class="text-xs text-gray-400 mt-3 bg-gray-900 p-2 rounded border-l-4 border-purple-500">
                                    📋 This resource contains QA documentation, guides, or templates for your testing workflows.
                                </div>
                            </div>
                        </div>`;
                    break;
                
                case 'prompts_list':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-pink-400 font-bold text-lg">💭 MCP Prompts Available (${data.prompts.length})</span>
                            </div>
                            <div class="space-y-3">
                                ${data.prompts.map(prompt => `
                                    <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg hover:bg-gray-700 transition-colors">
                                        <div class="font-bold text-pink-300">${prompt.name}</div>
                                        <div class="text-gray-300 mt-1">${prompt.description}</div>
                                        <div class="text-xs text-gray-400 mt-2">Click "✨ Generate Prompt" after selecting this prompt</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>`;
                    break;
                
                case 'prompt_content':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-yellow-400 font-bold text-lg">✨ Generated Prompt: ${data.name}</span>
                            </div>
                            <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg">
                                <div class="text-gray-300 whitespace-pre-wrap">${data.content}</div>
                                <div class="text-xs text-gray-400 mt-3 bg-gray-900 p-2 rounded border-l-4 border-yellow-500">
                                    🤖 Copy this prompt and use it with Claude, ChatGPT, or other AI tools for QA tasks.
                                </div>
                            </div>
                        </div>`;
                    break;
                
                case 'demo':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-rainbow font-bold text-xl">🎯 MCP Demo Results</span>
                                <span class="ml-3 px-2 py-1 bg-green-500 text-white text-xs rounded-full">LIVE DEMO</span>
                            </div>
                            <div class="bg-gradient-to-br from-gray-800 to-gray-900 border border-green-500 p-4 rounded-lg shadow-lg">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <div class="text-green-400 font-semibold mb-2">🎲 Demo ID:</div>
                                        <div class="bg-gray-900 p-2 rounded text-cyan-300 font-mono">${data.demo_id}</div>
                                    </div>
                                    <div>
                                        <div class="text-blue-400 font-semibold mb-2">📊 MCP Status:</div>
                                        <div class="bg-gray-900 p-2 rounded">
                                            <span class="text-green-300 font-bold">${data.mcp_ready ? '✅ READY' : '❌ NOT READY'}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <div class="text-yellow-400 font-semibold mb-2">🛠️ Tool Called:</div>
                                    <div class="bg-gray-900 p-2 rounded text-orange-300 font-mono">${data.demo_tool_call.tool}</div>
                                </div>
                                <div class="mb-4">
                                    <div class="text-purple-400 font-semibold mb-2">👥 Generated Test Data:</div>
                                    <pre class="bg-gray-900 border border-gray-700 p-3 rounded text-green-300 text-sm overflow-x-auto max-h-60">${JSON.stringify(data.demo_tool_call.result.data, null, 2)}</pre>
                                </div>
                                <div class="mb-4">
                                    <div class="text-blue-400 font-semibold mb-2">📋 Tool Arguments:</div>
                                    <pre class="bg-gray-900 border border-gray-700 p-2 rounded text-cyan-300 text-xs overflow-x-auto">${JSON.stringify(data.demo_tool_call.arguments, null, 2)}</pre>
                                </div>
                                <div class="text-xs text-gray-400 bg-gradient-to-r from-green-900 to-blue-900 p-3 rounded border-l-4 border-green-400">
                                    <strong class="text-green-300">🎉 Demo Complete!</strong> This shows MCP working end-to-end: 
                                    tool called ✅ → data generated ✅ → results delivered ✅
                                </div>
                            </div>
                        </div>`;
                    break;
                
                case 'error':
                    html = `
                        <div class="mb-4">
                            <div class="flex items-center mb-3">
                                <span class="text-red-400 font-bold text-lg">❌ Error</span>
                            </div>
                            <div class="bg-red-900 bg-opacity-50 border border-red-500 p-4 rounded-lg">
                                <div class="text-red-300">${data.message}</div>
                                <div class="text-xs text-red-400 mt-2">
                                    💡 Try refreshing the page or check the console for more details.
                                </div>
                            </div>
                        </div>`;
                    break;
                
                default:
                    html = `
                        <div class="mb-4">
                            <div class="bg-gray-800 border border-gray-600 p-4 rounded-lg">
                                <pre class="text-gray-300 text-sm overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        </div>`;
            }
            
            outputDiv.innerHTML = html;
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Enhanced Test Data Generation using MCP Tools
        async function generateEnhancedUsersMCP() {
            const count = document.getElementById('userCount').value || 3;
            const format = document.getElementById('userFormat').value || 'json';
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/tools/generate_test_data/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'users',
                        count: parseInt(count),
                        format: format
                    })
                });
                
                const data = await response.json();
                displayEnhancedResults('users', data);
            } catch (error) {
                console.error('Error generating users via MCP:', error);
                displayEnhancedResults('error', { message: `Error: ${error.message}` });
            }
        }

        async function generateEnhancedOrdersMCP() {
            const count = document.getElementById('orderCount').value || 5;
            const format = document.getElementById('orderFormat').value || 'json';
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/tools/generate_test_data/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'orders',
                        count: parseInt(count),
                        format: format
                    })
                });
                
                const data = await response.json();
                displayEnhancedResults('orders', data);
            } catch (error) {
                console.error('Error generating orders via MCP:', error);
                displayEnhancedResults('error', { message: `Error: ${error.message}` });
            }
        }

        async function generateMixedDataMCP() {
            const count = document.getElementById('mixedCount').value || 10;
            const format = document.getElementById('mixedFormat').value || 'json';
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/tools/generate_test_data/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'mixed',
                        count: parseInt(count),
                        format: format
                    })
                });
                
                const data = await response.json();
                displayEnhancedResults('mixed', data);
            } catch (error) {
                console.error('Error generating mixed data via MCP:', error);
                displayEnhancedResults('error', { message: `Error: ${error.message}` });
            }
        }

        // AI Analysis using MCP Tools
        async function runAIDemoMCP() {
            const analysisType = document.getElementById('aiDemoType').value;
            const provider = document.getElementById('aiProvider').value || 'mock';
            
            // Sample data for demo
            const sampleData = {
                users: [
                    { id: 1, name: "John Doe", email: "john@example.com", age: 30 },
                    { id: 2, name: "Jane Smith", email: "jane@example.com", age: 25 }
                ],
                test_results: {
                    total_tests: 150,
                    passed: 142,
                    failed: 8,
                    execution_time: "5m 32s"
                }
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/tools/analyze_with_ai/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        data: sampleData,
                        analysis_type: analysisType,
                        ai_provider: provider
                    })
                });
                
                const data = await response.json();
                displayAIResults('demo', data);
            } catch (error) {
                console.error('Error running AI demo via MCP:', error);
                displayAIResults('error', { message: `Error: ${error.message}` });
            }
        }

        async function analyzeCurrentDataMCP() {
            const analysisType = document.getElementById('aiAnalysisType').value;
            const provider = document.getElementById('analysisProvider').value || 'mock';
            
            // Get the last generated data from enhanced results
            const lastData = window.lastGeneratedData || {
                message: "No data available",
                suggestion: "Generate some test data first using the Enhanced Test Data Generation section"
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/mcp/tools/analyze_with_ai/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        data: lastData,
                        analysis_type: analysisType,
                        ai_provider: provider
                    })
                });
                
                const data = await response.json();
                displayAIResults('analysis', data);
            } catch (error) {
                console.error('Error analyzing data via MCP:', error);
                displayAIResults('error', { message: `Error: ${error.message}` });
            }
        }

        function showMCPCapabilities() {
            // Redirect to MCP tools section
            document.querySelector('#mcpGuide').scrollIntoView({ behavior: 'smooth' });
            if (document.querySelector('#mcpGuide').classList.contains('hidden')) {
                toggleMCPGuide();
            }
        }

        // Display functions for enhanced results
        function displayEnhancedResults(type, data) {
            const resultsDiv = document.getElementById('enhancedResults');
            const outputDiv = document.getElementById('enhanced-data-output');
            
            resultsDiv.classList.remove('hidden');
            
            // Store the data for AI analysis
            window.lastGeneratedData = data;
            
            let html = '';
            
            if (type === 'error') {
                html = `<div class="text-red-400">❌ ${data.message}</div>`;
            } else {
                html = `
                    <div class="mb-2 text-green-400">
                        🔗 MCP Tool: generate_test_data | Type: ${type} | Status: ✅ Success
                    </div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            }
            
            outputDiv.innerHTML = html;
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function displayAIResults(type, data) {
            const resultsDiv = document.getElementById('aiResults');
            const outputDiv = document.getElementById('ai-output');
            
            resultsDiv.classList.remove('hidden');
            
            let html = '';
            
            if (type === 'error') {
                html = `<div class="text-red-400">❌ ${data.message}</div>`;
            } else {
                html = `
                    <div class="mb-2 text-cyan-400">
                        🔗 MCP Tool: analyze_with_ai | Type: ${type} | Status: ✅ Success
                    </div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            }
            
            outputDiv.innerHTML = html;
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>